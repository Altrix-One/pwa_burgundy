const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/User-DRURSIwv.js","assets/index-W_lnXAtG.js","assets/index-BOqt-JOb.css","assets/Avatar.vue_vue_type_script_setup_true_lang-BYVCYYui.js","assets/Popover-D9lPCEKX.js","assets/User-BN6-I8-E.css"])))=>i.map(i=>d[i]);
var k=Object.defineProperty;var w=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var b=(c,e,t)=>e in c?k(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,_=(c,e)=>{for(var t in e||(e={}))g.call(e,t)&&b(c,t,e[t]);if(w)for(var t of w(e))E.call(e,t)&&b(c,t,e[t]);return c};var h=(c,e,t)=>new Promise((s,a)=>{var i=l=>{try{r(t.next(l))}catch(p){a(p)}},o=l=>{try{r(t.throw(l))}catch(p){a(p)}},r=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,o);r((t=t.apply(c,e)).next())});import{v as d,S as u,J as f,r as n,k as S,h as O,s as F,c as m,K as v,U as y}from"./index-W_lnXAtG.js";import{f as N}from"./User-DRURSIwv.js";class j{constructor(){this.callbacks={},this.callbacks.base={}}on(e,t){const s=this;return typeof e=="undefined"||e===""?(console.warn("wrong names"),!1):typeof t=="undefined"?(console.warn("wrong callback"),!1):(this.resolveNames(e).forEach(function(i){const o=s.resolveName(i);s.callbacks[o.namespace]instanceof Object||(s.callbacks[o.namespace]={}),s.callbacks[o.namespace][o.value]instanceof Array||(s.callbacks[o.namespace][o.value]=[]),s.callbacks[o.namespace][o.value].push(t)}),this)}off(e){const t=this;return typeof e=="undefined"||e===""?(console.warn("wrong name"),!1):(this.resolveNames(e).forEach(function(a){const i=t.resolveName(a);if(i.namespace!=="base"&&i.value==="")delete t.callbacks[i.namespace];else if(i.namespace==="base")for(const o in t.callbacks)t.callbacks[o]instanceof Object&&t.callbacks[o][i.value]instanceof Array&&(delete t.callbacks[o][i.value],Object.keys(t.callbacks[o]).length===0&&delete t.callbacks[o]);else t.callbacks[i.namespace]instanceof Object&&t.callbacks[i.namespace][i.value]instanceof Array&&(delete t.callbacks[i.namespace][i.value],Object.keys(t.callbacks[i.namespace]).length===0&&delete t.callbacks[i.namespace])}),this)}trigger(e,t){if(typeof e=="undefined"||e==="")return console.warn("wrong name"),!1;const s=this;let a=null;console.log("before args",t);const i=t instanceof Array?t:[t];console.log("after args",i);let o=this.resolveNames(e);if(o=this.resolveName(o[0]),o.namespace==="base")for(const r in s.callbacks)s.callbacks[r]instanceof Object&&s.callbacks[r][o.value]instanceof Array&&s.callbacks[r][o.value].forEach(function(l){l.apply(s,i)});else if(this.callbacks[o.namespace]instanceof Object){if(o.value==="")return console.warn("wrong name"),this;s.callbacks[o.namespace][o.value].forEach(function(r){r.apply(s,i)})}return a}resolveNames(e){let t=e;return t=t.replace(/[^a-zA-Z0-9 ,/.]/g,""),t=t.replace(/[,/]+/g," "),t=t.split(" "),t}resolveName(e){const t={},s=e.split(".");return t.original=e,t.value=s[0],t.namespace="base",s.length>1&&s[1]!==""&&(t.namespace=s[1]),t}}const P=c=>h(void 0,null,function*(){try{const e=d({doctype:c,fields:["name"]});return yield e.reload(),{success:e}}catch(e){return{error:e.message||"An error occurred"}}}),D=c=>h(void 0,null,function*(){const e=Object.assign({"../../public/json/exported.json":()=>u(()=>import("./exported-CAKphMl4.js"),[]),"../../public/json/form_list.json":()=>u(()=>import("./User-DRURSIwv.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5])),"../../public/json/task.json":()=>u(()=>import("./task-BcInbutv.js"),[]),"../../public/json/test_form.json":()=>u(()=>import("./test_form-BvInLsWc.js"),[])}),t={};for(const s in e){const a=yield e[s]();if(a.default&&a.default.doctype_name)t[a.default.doctype_name]=a.default;else{const i=Object.keys(a.default)[0];t[i]=a.default}}return c?t[c]:""}),V=()=>h(void 0,null,function*(){const c=d({doctype:"PWA Form",fields:["*"]});return yield c.reload(),c});class A extends j{constructor(e,t,s=null){super(),this.doctype=e,this.name=s,this.fields=f([]),this.dirty=!1,this.Frm=t,this.JSON=n({}),this.Docstatus=n(0),this.Saved=n(0),this.Submit=n(0),this.Amend=n(0),this.workflowStatus=n(!1),this.workflow_state=n(""),this.recordRetrieve=n(0),this.roles=[],this.style=n(""),this.status=n([]),this.child=n(0),this.DoctypeError=n(""),this.workflowError=n(""),this.router=S(),this.transition=n([]),this.username=O(()=>F.user),this.attachValues=f([]),this.action=n(""),this.data=n({}),this.doc=f({docstatus:0}),this.submitable=n(0),this.on("name",a=>{this.dirty=!0})}initFields(){return h(this,null,function*(){const e=d({doctype:"Workflow",fields:["*"],filters:{document_type:this.doctype}});e.reload().then(()=>{e.data.forEach(s=>{if(s.is_active){this.workflowStatus=!0;const a=m({url:"frappe.desk.form.load.getdoc",method:"GET",params:{doctype:"Workflow",name:s.name,_:Date.now()}});a.fetch().then(()=>{this.status=a.data.docs[0].states,this.transition=a.data.docs[0].transitions})}})});const t=yield V();if(t.data?t.data.forEach(s=>{if(s.doctype_name==this.doctype){const a=JSON.parse(s.pwa_form_fields);this.JSON=a,this.data=this.JSON,this.fields=this.JSON.pwa_form_fields,this.submitable=this.JSON.is_submittable,this.child=this.JSON.is_child_table}}):N.form_list.forEach(s=>h(this,null,function*(){if(s.form_name===this.Frm){const a=yield D(s.doctype_name);this.JSON=a,this.data=this.JSON,this.fields=this.JSON.pwa_form_fields,this.submitable=this.JSON.is_submittable,this.child=this.JSON.is_child_table}})),this.doc={},this.name!=null){const s=m({url:"frappe.desk.form.load.getdoc",method:"GET",params:{doctype:this.doctype,name:this.name,_:Date.now()}});s.reload().then(()=>{const a=s.data.docs[0];s.data.docs[0].docstatus==0?(this.Docstatus=s.data.docs[0].docstatus,this.Saved=1):(s.data.docs[0].docstatus==1||s.data.docs[0].docstatus==2)&&(this.Docstatus=s.data.docs[0].docstatus,this.Submit=1,this.Saved=1),this.workflowStatus&&(this.workflow_state=s.data.docs[0].workflow_state,this.styles()),Object.keys(a).forEach(i=>{this.doc[i]=a[i]}),this.updateFields()})}})}workflow(){this.doc.doctype=this.doctype;const e=m({url:"frappe.model.workflow.apply_workflow",method:"POST",params:{doc:this.doc,action:this.action}});e.fetch().then(()=>{Object.entries(e.data).forEach(([t,s])=>{this.doc[t]=s}),this.actions(e.data)})}actions(e){this.doc.doctype=this.doctype;const t=m({url:"frappe.model.workflow.get_transitions",method:"POST",params:{doc:e}});t.fetch().then(()=>t.data.length>0?(this.workflow_state=t.data[0].state,this.action=t.data[0].action,this.styles(),!0):(this.workflow_state=this.doc.workflow_state,this.action="",this.styles(),!0))}styles(){const e=d({doctype:"Workflow State",fields:["style"],filters:{name:this.workflow_state}});e.reload().then(()=>{this.style=e.data[0].style})}updateFields(){this.fields.forEach(e=>{this.doc.hasOwnProperty(e.fieldname)&&(e.value=this.doc[e.fieldname]),this.workflowStatus&&this.actions(this.doc)}),this.recordRetrieve=1}getValue(e){return this.doc[e]||null}setValue(e,t){this.dirty=!0,this.doc[e]=t}setTableValue(e,t,s,a){this.doc[s]||(this.doc[s]=[]),this.doc[s][a]||(this.doc[s][a]={}),this.doc[s][a][e]=t}removeTableVale(e,t){Array.isArray(this.doc[e])&&this.doc[e].splice(t,1)}isNew(){return!!this.name}save(){let e=this.validateMandatory();if(e==!0){this.dirty=!1;const t=d({doctype:this.doctype});if(["creation","docstatus","idx","modified","modified_by","owner","doctype"].forEach(a=>{delete this.doc[a]}),this.doc.name&&this.Docstatus){let a=this.doc.name;this.doc.amended_from=a;let i=a.split("-"),o=i[0],r=i.length>1?parseInt(i[1])+1:1;this.doc.name=`${o}-${r}`}return this.doc.name?t.setValue.submit(this.doc).then(a=>(Object.assign(this.doc,a),this.Saved=1,this.updateFields(),this.name=this.doc.name,this.Docstatus=0,this.fields.forEach(i=>{i.fieldtype==="Attach"?this.attachValues.forEach(o=>{if(o.FeildName===i.fieldname){const r=d({doctype:"File",filters:{name:o.name}});r.setValue.submit({name:o.name,attached_to_doctype:this.doctype,attached_to_name:a.name,attached_to_field:o.FeildName}),r.fetch()}}):typeof i.value=="object"&&i.value!=null&&i.value.forEach(o=>{o.fieldtype==="Attach"&&this.attachValues.forEach(r=>{if(r.FeildName===o.fieldname){const l=d({doctype:"File",filters:{name:r.name}});l.setValue.submit({name:r.name,attached_to_doctype:this.doctype,attached_to_name:a.name,attached_to_field:r.FeildName}),l.fetch()}})})}),a.name)).catch(a=>{throw new Error("Something went wrong")}):t.insert.submit(this.doc).then(a=>(Object.assign(this.doc,a),this.Saved=1,this.updateFields(),this.name=this.doc.name,this.Docstatus=0,this.fields.forEach(i=>{i.fieldtype==="Attach"?this.attachValues.forEach(o=>{if(o.FeildName===i.fieldname){const r=d({doctype:"File",filters:{name:o.name}});r.setValue.submit({name:o.name,attached_to_doctype:this.doctype,attached_to_name:a.name,attached_to_field:o.FeildName}),r.fetch()}}):typeof i.value=="object"&&i.value!=null&&i.value.forEach(o=>{o.fieldtype==="Attach"&&this.attachValues.forEach(r=>{if(r.FeildName===o.fieldname){const l=d({doctype:"File",filters:{name:r.name}});l.setValue.submit({name:r.name,attached_to_doctype:this.doctype,attached_to_name:a.name,attached_to_field:r.FeildName}),l.fetch()}})})}),a.name)).catch(a=>{throw new Error("Something went wrong")})}else return e}update(){const e=_({},this.doc);delete e.modified_by,delete e.modified,d({doctype:this.doctype,filters:{name:this.name}}).setValue.submit(e).then(()=>this.Saved=1)}submit(e){let t=this.validateMandatory();if(t==!0){this.dirty=!1;const s=d({doctype:this.doctype,filters:{name:e}});return s.reload().then(()=>s.setValue.submit({name:e,docstatus:1})).then(a=>(this.Docstatus=1,this.Submit=1,a.docstatus)).catch(a=>{throw console.log(a),new Error("Something went wrong")})}else return t}delete(e){const t=n("");return v({doctype:this.doctype,name:e}).delete.submit().then(a=>(t.value="Document Deleted successfully",t.value)).catch(a=>(console.error(a),t.value="Error deleting document",t.value))}cancel(e){this.dirty=!1;const t=d({doctype:this.doctype,filters:{name:e}});return t.reload().then(()=>t.setValue.submit({name:e,docstatus:2})).then(s=>(this.Docstatus=2,s.docstatus)).catch(s=>{throw console.log(s),new Error("Error Canceling document")})}amend(){return h(this,null,function*(){["creation","docstatus","idx","modified","modified_by","owner","doctype"].forEach(t=>{delete this.doc[t]}),v({doctype:this.doctype,name:this.name});try{this.Docstatus=0,this.Saved=0,this.router.push({name:"Form",query:{frmname:this.Frm,doctype:this.doctype}})}catch(t){console.error("Error:",t)}})}isDirty(){return this.dirty}validateMandatory(){const e=n([]);for(let t of this.fields)t.reqd&&!this.doc[t.fieldname]&&e.value.push(`Error: value missing for ${this.doctype}: ${t.label}`);return e.value.length>0?e.value:!0}}const L=y("form",{state:()=>({form:f(new A("Sampel"))}),actions:{initForm(){return h(this,null,function*(){yield this.form.initFields()})},setForm(c){this.form=f(c)}}}),I=y("landingPage",{state:()=>({links:[],options:[]}),actions:{setLinks(c){this.links=c},setOptions(c){this.options=c}}}),M=y("listPage",{state:()=>({reports:[]}),actions:{setReport(c){this.reports=c}}});export{V as a,P as b,M as c,I as l,D as r,L as u};
