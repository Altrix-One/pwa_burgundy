var z=(m,e,f)=>new Promise((p,r)=>{var i=u=>{try{h(f.next(u))}catch(g){r(g)}},C=u=>{try{h(f.throw(u))}catch(g){r(g)}},h=u=>u.done?p(u.value):Promise.resolve(u.value).then(i,C);h((f=f.apply(m,e)).next())});import{u as Y}from"./formStore-DlFuB_8v.js";import{_ as A,a as Z,b as ee,c as te,d as se,e as oe,f as ae,g as re,h as le,i as L,j as ce,L as ne,k as ie,l as me,C as de}from"./SectionBreak-Bd97OJzX.js";import{U as fe,D as ue}from"./User-DRURSIwv.js";import{m as pe,r as l,z as N,h as y,A as B,k as ve,o,a as n,b as t,d as v,u as a,_ as c,t as w,p as b,F as q,q as I,B as _,C as _e,j as x,l as R,f as V,w as P,x as he,y as we,n as xe,E as ye}from"./index-W_lnXAtG.js";import"./TextInput.vue_vue_type_script_setup_true_lang-CdzQ2H2L.js";import"./Popover-D9lPCEKX.js";import"./FormControl.vue_vue_type_script_setup_true_lang-DwYvdCJj.js";import"./Avatar.vue_vue_type_script_setup_true_lang-BYVCYYui.js";const M=m=>(he("data-v-18479e24"),m=m(),we(),m),be={class:"w-full sm:w-96 bg-white flex justify-center h-screen"},ge={class:"w-full flex flex-col"},ke={class:"w-full sm:w-96 bg-white h-14 shadow-lg fixed top-0 z-10"},Se={class:"flex px-2 items-center"},Ce={class:"flex-1 text-center"},$e={class:"font-semibold min-w-[5rem] w-fit text-xl pt-[8px] pr-2"},Ee={class:"w-full flex justify-end"},De={class:"p-1"},Fe={class:"flex-1 overflow-y-auto custom-scrollbar pt-20 pb-14 p-2 bg-gray-200"},ze={class:"p-2 bg-white rounded-lg"},Be={key:0,class:"fixed w-full sm:w-96 text-center h-[8rem] p-3 z-[100] flex mt-[50vh]"},Te={class:"w-full rounded-md bg-white border-t border-gray-300 shadow-lg p-2"},je={class:"flex w-full"},Ae=M(()=>t("p",{class:"font-semibold"},"Error",-1)),Le={class:"p-2"},Ne={class:"text-[14px] truncate mt-3"},qe={key:2,class:"fixed w-full sm:w-96 text-center h-[8rem] p-3 z-[100] flex mt-[5vh] animate-slideFromAbove"},Ie={class:"w-full rounded-md bg-white border-t border-gray-300 shadow-lg p-2"},Re={class:"flex w-full"},Ve=M(()=>t("p",{class:"font-semibold"},"workflow-Error",-1)),Pe={class:"p-2"},Me={class:"text-[14px] truncate mt-3"},Oe={class:"flex w-full sm:w-96 pl-3 pb-1 pt-1 fixed bottom-0 z-10 bg-white justify-center shadow-lg"},Ue={class:"pt-1 w-[20rem] sm:w-[20rem] ml-3"},He={key:1,class:b(["fixed bottom-[4rem] leading-5 pr-[60rem] pl-[2.5rem] z-50 w-[20rem] sm:w-96 animate-slide-in"])},We={key:2,class:b(["fixed bottom-[4rem] leading-5 pr-[60rem] pl-[2.5rem] z-50 w-[20rem] sm:w-96 animate-slide-in"])},Ge={class:"p-2 pr-2 pt-[5px]"},Je={__name:"form_builder",props:{frm:Object,doctype:String,frnname:String},setup(m){const e=m,f={Data:A,Select:Z,Int:ee,Autocomplete:te,Heading:se,Datetime:oe,Date:ae,"Section Break":re,Check:le,Text:A,"Long Text":L,"Small Text":L,Float:ce,Link:ne,Currency:ie,Attach:me,Table:de},p=l(!1),r=l(""),i=l(!1),C=l(0),h=l(!1),u=l(""),g=l(0),O=l({}),$=l(""),E=l(!1),D=l(""),k=l(!1);e.frm.doctype=e.doctype,e.frm.Frm=e.frnname,N(e.frm,s=>{s.workflowError&&(D.value=s.workflowError,D.value&&(k.value=!0)),s.DoctypeError&&($.value=s.DoctypeError,$.value&&(E.value=!0,k.value=!1))});const T=()=>{E.value=!1,e.frm.doc={docstatus:0},e.frm.name=null,e.frm.fields=[],e.frm.Docstatus=0,e.frm.Saved=0,e.frm.Submit=0,e.frm.Amend=0,e.frm.DoctypeError="",$.value="",F.push({name:"LandingPage",query:{frmname:e.frm.Frm,doctype:e.frm.doctype}})},j=()=>{e.frm.workflowError="",D.value="",k.value=!1};N(g,s=>{s===1&&(h.value=!1)});const U=()=>z(this,null,function*(){p.value=!0,C.value=e.frm.submitable;try{const s=yield e.frm.save();typeof s=="object"?r.value=s:typeof s=="string"&&(u.value=s,r.value="Save successful!",i.value=!0,C.value===1&&(h.value=!0),O.value=e.frm.doc,F.push({path:"/showform",query:{docname:s,frmname:e.frm.Frm,doctype:e.frm.doctype}}))}catch(s){r.value=`Error: ${s.message}`,i.value=!1,console.error(`Error: ${s.message}`)}finally{p.value=!1,setTimeout(()=>{r.value=""},2500)}}),H=y(()=>{const s=[];let S=0;for(const d of e.frm.fields)d.fieldtype==="Section Break"?(S+=1,s.push(d)):S===0&&s.push(d);return s}),W=y(()=>{if(e.frm.Saved===0)return"Not Saved"}),G=y(()=>{if(e.frm.Saved===0)return" px-[2px] mt-[1px] border-red-500 border-[0.5px] rounded-2xl text-center"}),J=y(()=>{if(e.frm.Saved===0)return" text-[12px]  text-red-500"}),K=y(()=>[{group:"Actions",items:[{label:"Print",icon:()=>B(c,{name:"printer"})},{label:"Create New "+e.frm.doctype,icon:()=>B(c,{name:"file-plus"})},{label:"Reload",icon:()=>B(c,{name:"refresh-ccw"}),onClick:()=>{window.location.reload()}}]}]),F=ve(),Q=()=>{e.frm.doc={docstatus:0},e.frm.name=null,e.frm.fields=[],e.frm.Docstatus=0,e.frm.Saved=0,e.frm.Submit=0,e.frm.Amend=0,F.push({name:"ListPage",query:{frmname:e.frm.Frm,doctype:e.frm.doctype}})};return(s,S)=>(o(),n("div",be,[t("div",ge,[t("div",ke,[t("div",Se,[v(a(c),{class:"w-8 h-8 text-gray-600 hover:text-black",name:"chevron-left",onClick:Q}),t("div",Ce,[t("p",$e,w(m.frm.doctype),1),t("div",null,[t("div",{class:b(G.value)},[t("p",{class:b(J.value)},w(W.value),3)],2)])]),t("div",Ee,[t("div",De,[v(a(c),{class:"w-6 h-6 text-gray-600 hover:text-black hover:cursor-pointer",name:"bell",onClick:S[0]||(S[0]=d=>a(F).push("/notifications"))})]),v(fe)])])]),t("div",Fe,[t("div",ze,[(o(!0),n(q,null,I(H.value,d=>(o(),_(_e(f[d.fieldtype]),{key:d.fieldname,field:d,frm:m.frm},null,8,["field","frm"]))),128))])]),E.value?(o(),n("div",Be,[t("div",Te,[t("div",je,[Ae,v(a(c),{name:"x",class:"w-5 h-5 ml-auto text-red-600 hover:cursor-pointer",onClick:T})]),t("div",Le,[t("p",Ne,w($.value),1)])])])):x("",!0),E.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black opacity-50 z-20 w-full sm:w-96",onClick:T})):x("",!0),k.value?(o(),n("div",qe,[t("div",Ie,[t("div",Re,[Ve,v(a(c),{name:"x",class:"w-5 h-5 ml-auto text-red-600 hover:cursor-pointer",onClick:j})]),t("div",Pe,[t("p",Me,w(D.value),1)])])])):x("",!0),k.value?(o(),n("div",{key:3,class:"fixed inset-0 bg-black opacity-50 z-20 w-full sm:w-96",onClick:j})):x("",!0),t("div",Oe,[t("div",Ue,[e.frm.Saved==0?(o(),_(a(R),{key:0,variant:"solid",theme:"gray",size:"sm",label:"Save",loading:p.value,loadingText:"Saving...",disabled:!1,link:null,class:"w-full h-[2rem] p-2",onClick:U},null,8,["loading"])):x("",!0),typeof r.value=="object"?(o(),n("div",He,[(o(!0),n(q,null,I(r.value,(d,X)=>(o(),n("div",{key:X,class:b(["rounded w-[20rem] h-fit p-2 text-left mb-2",{"bg-blue-200 text-blue-500":i.value,"bg-red-200 text-red-500":!i.value}])},[i.value?(o(),_(a(c),{key:0,name:"check",class:"inline w-4 h-4 mr-2"})):(o(),_(a(c),{key:1,name:"x",class:"inline w-4 h-4 mr-2"})),V(" "+w(d),1)],2))),128))])):r.value?(o(),n("div",We,[t("div",{class:b(["rounded w-[20rem] h-fit p-2 text-left",{"bg-blue-200 text-blue-500":i.value,"bg-red-200 text-red-500":!i.value}])},[i.value?(o(),_(a(c),{key:0,name:"check",class:"inline w-4 h-4 mr-2"})):(o(),_(a(c),{key:1,name:"x",class:"inline w-4 h-4 mr-2"})),V(" "+w(r.value),1)],2)])):x("",!0)]),t("div",Ge,[v(a(ue),{options:K.value},{default:P(()=>[v(a(R),null,{icon:P(()=>[v(a(c),{name:"more-vertical",class:"h-6 w-6 mt-[1px] text-gray-600 hover:text-black"})]),_:1})]),_:1},8,["options"])])])])]))}},Ke=pe(Je,[["__scopeId","data-v-18479e24"]]),Qe={class:"w-full flex-1 overflow-y-auto custom-scrollbar"},Xe={key:1},ct={__name:"Form",setup(m){const e=Y(),f=y(()=>e.form),p=ye();return xe(()=>z(this,null,function*(){yield e.initForm()})),(r,i)=>(o(),n("div",Qe,[f.value?(o(),_(Ke,{key:0,frm:f.value,frnname:a(p).query.frmname,doctype:a(p).query.doctype},null,8,["frm","frnname","doctype"])):(o(),n("p",Xe,"Loading..."))]))}};export{ct as default};
